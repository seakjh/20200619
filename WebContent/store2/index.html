
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
body {
	margin: 0;
	font-size: 9pt;
}
.wrapper{
	width: 1000px;
	height: 800px;
	border: 2px solid blue;
}
.registArea{
	width: 200px;
	height: 800px;
	background: #ffc;
	float: left;
}
.contentArea{
	width: 600px;
	height: 800px;
	background: transparent;
	float: left;
}
.detailArea{
	width: 200px;
	height: 800px;
	background: #fdd;
	float: left;
}
#listArea{
	width: 600px;
	height: 300px;
	overflow: scroll;
}
iframe{
	width: 600px;
	height: 500px;
}
div {
	text-align: center;
}
table, td {
	border: 1px solid #000;
	border-collapse: collapse;
}
</style>
<script type="text/javascript">
var map;
function loadData() {
	//비동기통신으로, 아이콘 가져오기!
	
	getIcons();
	//initMap();
}

function getIcons() {
	var httpObj = new XMLHttpRequest(); //비동기 통신 객체
	
	httpObj.onreadystatechange = function() {
		if(this.readyState == 4 && this.status == 200) {
			//alert("서버가 전송한 메세지 : "+ this.responseText);
			var json = JSON.parse(this.responseText);
			
			for (var i=0; i<json.iconsList.length; i++) {
				var icon = json.iconsList[i];
				var op = document.createElement("option");
				op.text = icon.title;
				op.value = icon.icons_id;
				var icons_id = document.getElementById("icons_id");
				icons_id.add(op); //select에 option을 동적으로 부착!
			}
		}
	}
	
	httpObj.open("GET", "/store/icons.jsp", true);
	httpObj.send();//통신시작
}

//비동기요청으로 파라미터 전송하기
function regist() {
	var httpObj = new XMLHttpRequest();
	httpObj.open("POST", "/store2/regist.jsp", true);
	httpObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	
	var name = document.getElementById("name").value;
	var addr = document.getElementById("addr").value;
	var lati = document.getElementById("lati").value;
	var longi = document.getElementById("longi").value;
	var icons_id = document.getElementById("icons_id").value;
	var memo = document.getElementById("memo").value;
	
	//요청결과 가져오기!
	httpObj.onreadystatechange = function() {
		if(this.readyState == 4 && this.status == 200) {
			//alert("서버가 전송한 메세지 : "+ this.responseText);
			if (this.responseText == 1) {
				alert("등록성공");
			}
			else {
				alert("등록실패");				
			}
		}
	}
	httpObj.send("name="+name+"&addr="+addr+"&lati="+lati+"&longi="+longi+"&icons_id="+icons_id+"&memo="+memo);
}

function getList() {
	var httpObj = new XMLHttpRequest();
	httpObj.onreadystatechange = function() {
		if(this.readyState == 4 && this.status == 200) {
			console.log(this.responseText);
			var json = JSON.parse(this.responseText);
			printData(json);
			//printMarker(json);
			//지도 프레임을 새로고침하자!
			//window.target="mapFrame";
			//location.href="http://naver.com";
		}
	};
	httpObj.open("GET", "/store2/list.jsp", true);
	httpObj.send();	
}

function printData(json) {
	//var contentArea = document.querySelector(".contentArea");
	var listArea = document.getElementById("listArea");
	var tag="<table width=\"100%\">";
	tag += "<tr>";
	tag += "<td>No</td>";
	tag += "<td>가게명</td>";
	tag += "<td>주소</td>";
	tag += "<td>아이콘</td>";
	tag += "<td>위도</td>";
	tag += "<td>경도</td>";
	tag += "<td>대표메뉴</td>";
	tag += "</tr>";
	for (var i=0; i<json.storeList.length; i++) {
		var obj = json.storeList[i];
		tag += "<tr onMouseOver=\"this.style.background='#fcc'\" onMouseOut=\"this.style.background=''\">";
		tag += "<td>"+obj.store_id+"</td>";
		tag += "<td><a onClick='show("+obj.store_id+")' style='cursor:pointer;color:red'>"+obj.name+"</a></td>";
		tag += "<td>"+obj.addr+"</td>";
		tag += "<td><img src='/icons/"+obj.filename+"' width='50px'></td>";
		tag += "<td>"+obj.lati+"</td>";
		tag += "<td>"+obj.longi+"</td>";
		tag += "<td>"+obj.memo+"</td>";
		tag += "</tr>";
		//mapMarker(obj);		
	}
	tag += "</table>";
	listArea.innerHTML=tag;
	
}

//0624방식
function mapMarker(obj) {
	var marker = new google.maps.Marker({
		position: new google.maps.LatLng(obj.lati, obj.longi),
		animation:google.maps.Animation.BOUNCE,
		icon:{
		    url: "/icons/"+obj.filename, // url
		    scaledSize: new google.maps.Size(30, 30), // scaled size
		}
	});//마커 생성
	marker.setMap(map);//마커를 지정한 맵에 적용!!
}

function initMap() {
	//alert("맵 로드할거야");
	var mapProp= {
	  center:new google.maps.LatLng(37.571252, 126.989102),
	  zoom:10,
	};
	map = new google.maps.Map(document.getElementById("mapArea"),mapProp);
}
</script>
</head>
<body>
	<div class="wrapper">
		<div class="registArea">
			<input type="text" id="name" placeholder="맛집명">
			<input type="text" id="addr" placeholder="주소">
			<input type="text" id="lati" placeholder="위도">
			<input type="text" id="longi" placeholder="경도">
			<select id="icons_id"></select>
			<textarea type="text" id="memo" placeholder="설명" rows="5" cols="22"></textarea>
			<button onclick="regist()">등록</button>
			<button onclick="getList()">목록</button>
		</div>
		
		<div class="contentArea">
			<div id="listArea"></div>
			<iframe src="/store2/map.html" frameborder="0" name="mapFrame"></iframe>
		</div>
		
		<div class="detailArea">
			<input type="text" name="name" placeholder="맛집명">
			<input type="text" name="name" placeholder="주소">
			<input type="text" name="name" placeholder="위도">
			<input type="text" name="name" placeholder="경도">
			<input type="text" name="name" placeholder="이미지">
			<select>
				<option>핀</option>
				<option>스마일</option>
				<option>가게</option>
				<option>도서관</option>
			</select>
			<textarea type="text" name="name" placeholder="설명" rows="5" cols="22"></textarea>
			<button>등록</button>
			<button>목록</button>
		</div>
	</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMEKY2uyaqvfsq-5QrhEYDOCnogkkXl0U&callback=loadData"></script>
</body>
</html>

